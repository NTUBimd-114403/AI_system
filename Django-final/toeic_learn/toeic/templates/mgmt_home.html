{% extends "mgmt_base.html" %}
{% block title %}æ¬¸ï¼æ„›å¤šç›Š - å¾Œå°ç®¡ç†ç³»çµ±{% endblock %}

{% block content %}
<div class="home-container">
    <!-- æ­¡è¿å€ -->
    <div class="welcome-section">
        <div class="welcome-text">
            <h1>æ­¡è¿å›ä¾†ï¼Œ{{ request.user.nickname }}</h1>
            <p>ç®¡ç†å“¡æ§åˆ¶é¢æ¿</p>
        </div>
        <div class="welcome-info">
            <p><i class="fa-solid fa-clock"></i> {{ current_time|date:"Y-m-d H:i" }}</p>
        </div>
    </div>

    <!-- å¿«é€Ÿçµ±è¨ˆ -->
    <div class="quick-stats">
        <div class="stat-card-home">
            <div class="stat-icon-home">ğŸ“ˆ</div>
            <div class="stat-info">
                <h3 id="todayUsers">-</h3>
                <p>ä»Šæ—¥æ–°å¢ç”¨æˆ¶</p>
            </div>
        </div>
        <div class="stat-card-home">
            <div class="stat-icon-home">âœ…</div>
            <div class="stat-info">
                <h3 id="todayExams">-</h3>
                <p>ä»Šæ—¥æ¸¬é©—æ¬¡æ•¸</p>
            </div>
        </div>
        <div class="stat-card-home">
            <div class="stat-icon-home">â³</div>
            <div class="stat-info">
                <h3 id="pendingApproval">-</h3>
                <p>å¾…å¯©æ ¸é …ç›®</p>
            </div>
        </div>
        <div class="stat-card-home">
            <div class="stat-icon-home">ğŸ’š</div>
            <div class="stat-info">
                <h3>é‹è¡Œä¸­</h3>
                <p>ç³»çµ±ç‹€æ…‹</p>
            </div>
        </div>
    </div>

    <!-- å¿«æ·æ“ä½œ -->
    <div class="quick-actions">
        <h2>å¿«æ·æ“ä½œ</h2>
        <div class="action-grid">
            <a href="/mgmt-user/" class="action-card">
                <i class="fa-solid fa-users fa-2x"></i>
                <h3>ç”¨æˆ¶ç®¡ç†</h3>
                <p>ç®¡ç†å¹³å°ç”¨æˆ¶</p>
            </a>
            <a href="/mgmt-point/" class="action-card">
                <i class="fa-solid fa-coins fa-2x"></i>
                <h3>é»æ•¸ç®¡ç†</h3>
                <p>æŸ¥çœ‹äº¤æ˜“è¨˜éŒ„</p>
            </a>
            <a href="/mgmt-question/" class="action-card">
                <i class="fa-solid fa-question-circle fa-2x"></i>
                <h3>é¡Œç›®ç®¡ç†</h3>
                <p>æ–°å¢ã€ç·¨è¼¯é¡Œç›®</p>
            </a>
            <a href="/mgmt-dashboard/" class="action-card">
                <i class="fa-solid fa-chart-line fa-2x"></i>
                <h3>çµ±è¨ˆå„€è¡¨æ¿</h3>
                <p>æ•¸æ“šåˆ†æå ±è¡¨</p>
            </a>
        </div>
    </div>

    <!-- æœ€è¿‘æ´»å‹• -->
    <div class="recent-activity">
        <h2>æœ€è¿‘æ´»å‹•</h2>
        <div class="activity-columns">
            <div class="activity-card">
                <h3>æœ€æ–°è¨»å†Šç”¨æˆ¶</h3>
                <ul id="recentUsers">
                    <li>è¼‰å…¥ä¸­...</li>
                </ul>
            </div>
            <div class="activity-card">
                <h3>æœ€æ–°é»æ•¸äº¤æ˜“</h3>
                <ul id="recentTransactions">
                    <li>è¼‰å…¥ä¸­...</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- æ“ä½œèªªæ˜ -->
    <div class="help-section">
        <div class="help-card">
            <i class="fa-solid fa-bars fa-2x"></i>
            <div>
                <h3>ä½¿ç”¨å°è¦½</h3>
                <p>é»æ“Šå·¦ä¸Šè§’çš„ <strong>â˜°</strong> æŒ‰éˆ•æ‰“é–‹å´é‚Šé¸å–®ï¼Œå³å¯è¨ªå•æ‰€æœ‰ç®¡ç†åŠŸèƒ½</p>
            </div>
        </div>
    </div>
</div>

<script>
    // è¼‰å…¥çµ±è¨ˆæ•¸æ“š
    fetch('/mgmt/api/home/stats/')
        .then(r => r.json())
        .then(data => {
            document.getElementById('todayUsers').textContent = data.today_users;
            document.getElementById('todayExams').textContent = data.today_exams;
            document.getElementById('pendingApproval').textContent = data.pending_approval;

            // æœ€æ–°ç”¨æˆ¶
            const usersList = document.getElementById('recentUsers');
            if (data.recent_users.length > 0) {
                usersList.innerHTML = data.recent_users.map(u => 
                    `<li><strong>${u.nickname}</strong> (${u.email}) - ${u.date}</li>`
                ).join('');
            } else {
                usersList.innerHTML = '<li>æš«ç„¡è³‡æ–™</li>';
            }

            // æœ€æ–°äº¤æ˜“
            const transList = document.getElementById('recentTransactions');
            if (data.recent_transactions.length > 0) {
                transList.innerHTML = data.recent_transactions.map(t => 
                    `<li><strong>${t.user}</strong> ${t.amount > 0 ? '+' : ''}${t.amount} é» - ${t.reason}</li>`
                ).join('');
            } else {
                transList.innerHTML = '<li>æš«ç„¡è³‡æ–™</li>';
            }
        });
</script>
{% endblock %}